<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.min.js"></script>
    <meta charset="utf-8">
    <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,900' rel='stylesheet' type='text/css'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  </head>


  <body>
    <!-- Form -->
    <div class="back"></div>
    <div class="registration-form">
      <header>
        <h3>Mihy.Tech</h3>
        <p>Connect your Robot to our Network</p>
      </header>
      <form>
        <div class="input-section email-section">
          <input class="email" type="email" placeholder="Enter your Robot's IP here" autocomplete="off"/>
          <div class="animated-button"><span class="icon-paper-plane"><i class="fa fa-envelope-o"></i></span><span class="next-button email"><i class="fa fa-arrow-up"></i></span></div>
        </div>
        <div class="input-section password-section folded">
          <input class="password" type="email" placeholder="Enter your robot's port here"/>
          <div class="animated-button"><span class="icon-lock"><i class="fa fa-lock"></i></span><span class="next-button password"><i class="fa fa-arrow-up"></i></span></div>
        </div>
        <div class="input-section repeat-password-section folded">
          <input class="repeat-password" type="password" placeholder="Enter your password here"/>
          <div class="animated-button"><span class="icon-repeat-lock"><i class="fa fa-lock"></i></span><span class="next-button repeat-password"><i class="fa fa-paper-plane"></i></span></div>
        </div>
        <div class="success"> 
          <p>Connection Established</p>
        </div>
        
      </form>
    </div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script><script  src="./script.js"></script>

        
    <!-- Twitter Link -->
    <a href="https://github.com/whomihirpatel/4G-Networked_Robots" target="_blank" class="twitterLink">
        <img src="https://img.icons8.com/material-rounded/48/000000/github.png"/>
           </a>
        <!-- Map Database Link -->
    <a href="https://mihy.tech/maps" class="credit" target="_blank">Map Database</a>
    <a href="https://mihy.tech/viz/?rosbridge-websocket-url=ws://mihy.tech:9090" class="credit1" target="_blank">Visualize</a>
    <a href="https://mihy.tech/netdata" class="credit2" target="_blank">Server Stats</a>

     <!-- Log Text-->
    <p id="demo" class="demo"> log </p>
    <!--<p id="demo2" style="margin-top:100px" > log2 </p>-->
    
    <!-- Typed Text-->
    
    <div class="type-js headline">
        <h1 class="text-js">Welcome to the Robo Network!
    </div>


    <!-- Main Script-->
    <script type="text/javascript" type="text/javascript">

    
    function autoType(elementClass, typingSpeed){
        $(".cursor").css({ 'width' : '0' });
        
        var thhis = $(elementClass);
        thhis.css({
        "position": "relative",
        "display": "inline-block"
        });
        
        thhis.prepend('<div class="cursor" style="right: initial; left:0;"></div>');
        $(".cursor").css({ 'width' : '0' });
        thhis = thhis.find(".text-js");
        var text = thhis.text().trim().split('');
        var amntOfChars = text.length;
        var newString = "";
        thhis.text("|");
        setTimeout(function(){
        thhis.css("opacity",1);
        thhis.prev().removeAttr("style");
        thhis.text("");
        
        for(var i = 0; i < amntOfChars; i++){
            
            (function(i,char){
            setTimeout(function() {        
                newString += char;
                thhis.text(newString);
            },i*typingSpeed);
            })(i+1,text[i]);
        }
        
        },1500);
    }

    function repeat(){

    $(document).ready(function(){autoType(".type-js",50);});
    }
    //var t=setInterval(repeat,2000);
    repeat()
    
    
        // Connecting to ROS
        // -----------------

        var ros = new ROSLIB.Ros({
            url : 'ws://mihy.tech:10401'
        });

        ros.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
        });


        var ros2 = new ROSLIB.Ros({
            url : 'ws://mihy.tech:10402'
        });

        ros2.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros2.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros2.on('close', function() {
            console.log('Connection to websocket server closed.');
        });

        // Publishing a Topic
        // ------------------
        

        
        const demo = document
        

        //demo.addEventListener("keypress", cmd_vel_publish)
        
        
        

        
            
        var cmdVel = new ROSLIB.Topic({
            ros : ros,
            name : '/cmd_vel',
            messageType : 'geometry_msgs/Twist'
        });

        var cmdVel2 = new ROSLIB.Topic({
            ros : ros2,
            name : '/cmd_vel',
            messageType : 'geometry_msgs/Twist'
        });
        var current_robot = cmdVel

        demo.addEventListener("keypress", function(event) {
        if (event.key == "q"){
            if (current_robot == cmdVel){
                current_robot = cmdVel2
                console.log('zetabot');
            }
            else {
                current_robot = cmdVel
                console.log('alphabot');
            }
            
        }
        });

        demo.addEventListener("keypress", function(event) {
        if (event.key == "w"){
                console.log(event.code );
                var twist = new ROSLIB.Message({
                linear : {
                x : 0.2,
                y : 0.0,
                z : 0.0
                },
                angular : {
                x : 0.0,
                y : 0.0,
                z : 0.0
                }
            
            });
            current_robot.publish(twist);
            x = document.getElementsByClassName("text-js")[0].innerHTML = "linear.x = 0.2";
            repeat()
        }
        if (event.key == "a"){
                console.log(event.code );
                var twist = new ROSLIB.Message({
                linear : {
                x : 0.0,
                y : 0.0,
                z : 0.0
                },
                angular : {
                x : 0.0,
                y : 0.0,
                z : 2
                }
            
            });
            current_robot.publish(twist);
            document.getElementById("demo").innerHTML = "angular.x = 2.0";
        }
        if (event.key == "s"){
                console.log(event.code );
                var twist = new ROSLIB.Message({
                linear : {
                x : -0.2,
                y : 0.0,
                z : 0.0
                },
                angular : {
                x : 0.0,
                y : 0.0,
                z : 0.0
                }
            
            });
            current_robot.publish(twist);
            document.getElementById("demo").innerHTML = "linear.x = -0.2";
        }
        if (event.key == "d"){
                console.log(event.code );
                var twist = new ROSLIB.Message({
                linear : {
                x : 0.0,
                y : 0.0,
                z : 0.0
                },
                angular : {
                x : 0.0,
                y : 0.0,
                z : -2
                }
            
            });
            current_robot.publish(twist);
            document.getElementById("demo").innerHTML = "angular.z = - 2.0";
        }
        }
        );


           
            
        
            

        // Subscribing to a Topic
        // ----------------------

        var listener = new ROSLIB.Topic({
            ros : ros,
            name : '/listener',
            messageType : 'std_msgs/String'
        });

        listener.subscribe(function(message) {
            console.log('Received message on ' + listener.name + ': ' + message.data);
            listener.unsubscribe();
        });

        // Calling a service
        // -----------------
        /*
        var addTwoIntsClient = new ROSLIB.Service({
            ros : ros,
            name : '/add_two_ints',
            serviceType : 'rospy_tutorials/AddTwoInts'
        });

        var request = new ROSLIB.ServiceRequest({
            a : 1,
            b : 2
        });

        addTwoIntsClient.callService(request, function(result) {
            console.log('Result for service call on '
            + addTwoIntsClient.name
            + ': '
            + result.sum);
        });

        // Getting and setting a param value
        // ---------------------------------

        ros.getParams(function(params) {
            console.log(params);
        });

        var maxVelX = new ROSLIB.Param({
            ros : ros,
            name : 'max_vel_y'
        });

        maxVelX.set(0.8);
        maxVelX.get(function(value) {
            console.log('MAX VAL: ' + value);
        });
        */
    </script>
    <!--
         <script src="ros.js">
        
    </script>
    <form id="frm1"">
        First name: <input type="text" name="fname" value="Donald"><br>
        Last name: <input type="text" name="lname" value="Duck"><br><br>
        
    </form> 
    <input type="button" value="publish onclick= "cmd_vel_publish()" />
    -->
    
    
  </body>
</html>
